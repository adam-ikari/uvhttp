name: Branch Cleanup

on:
  pull_request:
    types: [closed]

permissions:
  contents: write

jobs:
  cleanup:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
    - name: Delete merged branch
      run: |
        BRANCH_NAME="${{ github.head_ref }}"
        echo "Deleting merged branch: $BRANCH_NAME"
        
        # 检查是否为 feature/* 或 fix/* 分支
        if [[ "$BRANCH_NAME" == feature/* ]] || [[ "$BRANCH_NAME" == fix/* ]]; then
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # 删除已合并的分支
          git push origin --delete "$BRANCH_NAME" || echo "Branch already deleted or doesn't exist"
          echo "Successfully deleted branch: $BRANCH_NAME"
        else
          echo "Skipping deletion for branch: $BRANCH_NAME (not a feature/* or fix/* branch)"
        fi