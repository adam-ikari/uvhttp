# UVHTTP 性能基准配置
# 定义性能基准值和回归检测阈值

# 性能基准值
# 更新时间: 2026-02-04
# 测试环境: Linux 6.14.11-2-pve
# 基于实际测试结果更新
baseline:
  # 低并发测试（2线程 / 10连接）
  low_concurrent:
    rps: 32183  # requests per second (峰值)
    latency_avg: 273.74  # microseconds (实际测试值)
    latency_p50: 270  # microseconds
    latency_p95: 320  # microseconds
    latency_p99: 450  # microseconds
    latency_p999: 600  # microseconds
    transfer_rate: 3.16  # MB/s
    errors: 0  # count
  
  # 中等并发测试（4线程 / 50连接）
  medium_concurrent:
    rps: 31000  # requests per second (实际测试值)
    latency_avg: 1500  # microseconds (1.5 ms)
    latency_p50: 1400  # microseconds
    latency_p95: 2000  # microseconds
    latency_p99: 3500  # microseconds (3.5 ms)
    latency_p999: 5000  # microseconds (5 ms)
    transfer_rate: 3.04  # MB/s
    errors: 0  # count
  
  # 高并发测试（8线程 / 200连接）
  high_concurrent:
    rps: 30000  # requests per second (实际测试值)
    latency_avg: 6500  # microseconds (6.5 ms)
    latency_p50: 6000  # microseconds (6 ms)
    latency_p95: 9000  # microseconds (9 ms)
    latency_p99: 15000  # microseconds (15 ms)
    latency_p999: 25000  # microseconds (25 ms)
    transfer_rate: 2.94  # MB/s
    errors: 0  # count
  
  # 极端并发测试（16线程 / 500连接）
  extreme_concurrent:
    rps: 28000  # requests per second (预估)
    latency_avg: 17000  # microseconds (17 ms)
    latency_p50: 16000  # microseconds (16 ms)
    latency_p95: 24000  # microseconds (24 ms)
    latency_p99: 40000  # microseconds (40 ms)
    latency_p999: 65000  # microseconds (65 ms)
    transfer_rate: 2.74  # MB/s
    errors: 0  # count
  
  # 超高并发测试（16线程 / 1000连接）
  very_high_concurrent:
    rps: 25000  # requests per second (预估)
    latency_avg: 38000  # microseconds (38 ms)
    latency_p50: 36000  # microseconds (36 ms)
    latency_p95: 52000  # microseconds (52 ms)
    latency_p99: 85000  # microseconds (85 ms)
    latency_p999: 130000  # microseconds (130 ms)
    transfer_rate: 2.45  # MB/s
    errors: 0  # count
  
  # 持续负载测试（4线程 / 100连接，60秒）
  sustained_load:
    rps: 30000  # requests per second (预估)
    latency_avg: 6200  # microseconds (6.2 ms)
    latency_p50: 5800  # microseconds (5.8 ms)
    latency_p95: 8800  # microseconds (8.8 ms)
    latency_p99: 14500  # microseconds (14.5 ms)
    latency_p999: 24000  # microseconds (24 ms)
    transfer_rate: 2.94  # MB/s
    errors: 0  # count
  
  # 小文件下载测试（4线程 / 100连接）
  small_file:
    rps: 29000  # requests per second (预估)
    latency_avg: 6800  # microseconds (6.8 ms)
    latency_p50: 6400  # microseconds (6.4 ms)
    latency_p95: 9600  # microseconds (9.6 ms)
    latency_p99: 16000  # microseconds (16 ms)
    latency_p999: 26000  # microseconds (26 ms)
    transfer_rate: 28.37  # MB/s
    errors: 0  # count
  
  # 大文件下载测试（4线程 / 50连接）
  large_file:
    rps: 8000  # requests per second (预估)
    latency_avg: 6000  # microseconds (6 ms)
    latency_p50: 5600  # microseconds (5.6 ms)
    latency_p95: 8400  # microseconds (8.4 ms)
    latency_p99: 14000  # microseconds (14 ms)
    latency_p999: 23000  # microseconds (23 ms)
    transfer_rate: 80.0  # MB/s
    errors: 0  # count

# 资源使用基准
resources:
  cpu_usage:
    baseline: 85  # percent
    warning_threshold: 93.5  # +10%
    failure_threshold: 102  # +20%
  
  memory_usage:
    baseline: 128  # MB
    warning_threshold: 140  # +10%
    failure_threshold: 153  # +20%
  
  context_switches:
    baseline: 12000  # per second
    warning_threshold: 13200  # +10%
    failure_threshold: 14400  # +20%
  
  system_calls:
    baseline: 45000  # per second
    warning_threshold: 49500  # +10%
    failure_threshold: 54000  # +20%

# 回归检测阈值
thresholds:
  # 吞吐量阈值（下降百分比）
  rps:
    warning: 0.10  # 10% 下降触发警告
    failure: 0.10  # 10% 下降触发失败
  
  # 延迟阈值（增加百分比）
  latency:
    warning: 0.10  # 10% 增加触发警告
    failure: 0.20  # 20% 增加触发失败
  
  # 资源使用阈值（增加百分比）
  resources:
    warning: 0.10  # 10% 增加触发警告
    failure: 0.20  # 20% 增加触发失败
  
  # 错误率阈值
  errors:
    warning: 0  # 任何错误触发警告
    failure: 0  # 任何错误触发失败

# 测试配置
test_config:
  # 每个场景运行次数
  iterations:
    low_concurrent: 5
    medium_concurrent: 5
    high_concurrent: 5
    extreme_concurrent: 3
    very_high_concurrent: 3
    sustained_load: 1
    small_file: 3
    large_file: 3
  
  # 测试持续时间（秒）
  duration:
    low_concurrent: 10
    medium_concurrent: 10
    high_concurrent: 10
    extreme_concurrent: 30
    very_high_concurrent: 30
    sustained_load: 60
    small_file: 10
    large_file: 10
  
  # 连接数
  connections:
    low_concurrent: 10
    medium_concurrent: 50
    high_concurrent: 100
    extreme_concurrent: 500
    very_high_concurrent: 1000
    sustained_load: 100
    small_file: 100
    large_file: 50
  
  # 线程数
  threads:
    low_concurrent: 4
    medium_concurrent: 4
    high_concurrent: 4
    extreme_concurrent: 8
    very_high_concurrent: 8
    sustained_load: 4
    small_file: 4
    large_file: 4
  
  # 超时时间（秒）
  timeout:
    low_concurrent: 5
    medium_concurrent: 5
    high_concurrent: 5
    extreme_concurrent: 10
    very_high_concurrent: 10
    sustained_load: 5
    small_file: 5
    large_file: 10

# 数据保留配置
retention:
  # GitHub Actions artifacts 保留天数
  artifacts: 90  # days
  
  # GitHub Releases 保留数量
  releases: 30  # count
  
  # 历史数据保留天数
  historical_data: 180  # days
  
  # 趋势图保留天数
  trend_charts: 90  # days

# 报告配置
report:
  # 报告格式
  formats:
    - markdown
    - json
  
  # 报告内容
  sections:
    - test_overview
    - test_environment
    - test_summary
    - detailed_results
    - resource_usage
    - performance_trends
    - regression_analysis
    - recommendations
    - appendix
  
  # 趋势图配置
  charts:
    - throughput_trends
    - latency_trends
    - p99_latency_trends
    - resource_usage_trends
  
  # 性能仪表板
  dashboard:
    update_interval: daily  # daily, weekly, monthly
    trend_periods:
      - 7  # 7 days
      - 30  # 30 days
      - 90  # 90 days

# 通知配置
notifications:
  # 回归检测通知
  regression:
    enabled: true
    channels:
      - github_issue
      - pull_request_comment
    
    # 严重级别
    severity:
      - failure
      - warning
  
  # 性能改进通知
  improvement:
    enabled: true
    channels:
      - github_issue
    
    # 最小改进百分比
    min_improvement: 0.05  # 5%

# CI/CD 集成配置
ci_cd:
  # 触发条件
  triggers:
    - schedule  # 每日定时运行
    - workflow_dispatch  # 手动触发
    - pull_request  # PR 触发
  
  # 阻止合并
  block_merge:
    enabled: true
    conditions:
      - regression_failure  # 检测到回归失败时阻止
  
  # 里程碑
  milestones:
    - daily  # 每日基准测试
    - release  # 发布前基准测试
    - feature  # 功能分支基准测试