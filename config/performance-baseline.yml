# UVHTTP 性能基准配置
# 定义性能基准值和回归检测阈值

# 性能基准值
baseline:
  # 低并发测试（10连接）
  low_concurrent:
    rps: 17798  # requests per second
    latency_avg: 518  # microseconds
    latency_p50: 500  # microseconds
    latency_p95: 800  # microseconds
    latency_p99: 1600  # microseconds
    latency_p999: 3000  # microseconds
    transfer_rate: 1.75  # MB/s
    errors: 0  # count
  
  # 中等并发测试（50连接）
  medium_concurrent:
    rps: 17209  # requests per second
    latency_avg: 2790  # microseconds (2.79 ms)
    latency_p50: 2600  # microseconds
    latency_p95: 4500  # microseconds
    latency_p99: 8500  # microseconds (8.5 ms)
    latency_p999: 15000  # microseconds (15 ms)
    transfer_rate: 1.69  # MB/s
    errors: 0  # count
  
  # 高并发测试（100连接）
  high_concurrent:
    rps: 16623  # requests per second
    latency_avg: 12200  # microseconds (12.2 ms)
    latency_p50: 11000  # microseconds (11 ms)
    latency_p95: 18000  # microseconds (18 ms)
    latency_p99: 40000  # microseconds (40 ms)
    latency_p999: 70000  # microseconds (70 ms)
    transfer_rate: 1.63  # MB/s
    errors: 0  # count
  
  # 极端并发测试（500连接）
  extreme_concurrent:
    rps: 15000  # requests per second
    latency_avg: 35000  # microseconds (35 ms)
    latency_p50: 32000  # microseconds (32 ms)
    latency_p95: 50000  # microseconds (50 ms)
    latency_p99: 90000  # microseconds (90 ms)
    latency_p999: 150000  # microseconds (150 ms)
    transfer_rate: 1.47  # MB/s
    errors: 0  # count
  
  # 超高并发测试（1000连接）
  very_high_concurrent:
    rps: 12000  # requests per second
    latency_avg: 85000  # microseconds (85 ms)
    latency_p50: 78000  # microseconds (78 ms)
    latency_p95: 120000  # microseconds (120 ms)
    latency_p99: 200000  # microseconds (200 ms)
    latency_p999: 300000  # microseconds (300 ms)
    transfer_rate: 1.17  # MB/s
    errors: 0  # count
  
  # 持续负载测试（100连接，60秒）
  sustained_load:
    rps: 16500  # requests per second
    latency_avg: 12000  # microseconds (12 ms)
    latency_p50: 11000  # microseconds (11 ms)
    latency_p95: 17500  # microseconds (17.5 ms)
    latency_p99: 39000  # microseconds (39 ms)
    latency_p999: 68000  # microseconds (68 ms)
    transfer_rate: 1.61  # MB/s
    errors: 0  # count
  
  # 小文件下载测试（100连接）
  small_file:
    rps: 16000  # requests per second
    latency_avg: 12500  # microseconds (12.5 ms)
    latency_p50: 11500  # microseconds (11.5 ms)
    latency_p95: 18000  # microseconds (18 ms)
    latency_p99: 40000  # microseconds (40 ms)
    latency_p999: 70000  # microseconds (70 ms)
    transfer_rate: 1.56  # MB/s
    errors: 0  # count
  
  # 大文件下载测试（50连接）
  large_file:
    rps: 5000  # requests per second
    latency_avg: 10000  # microseconds (10 ms)
    latency_p50: 9000  # microseconds (9 ms)
    latency_p95: 14000  # microseconds (14 ms)
    latency_p99: 30000  # microseconds (30 ms)
    latency_p999: 50000  # microseconds (50 ms)
    transfer_rate: 50.0  # MB/s
    errors: 0  # count

# 资源使用基准
resources:
  cpu_usage:
    baseline: 85  # percent
    warning_threshold: 93.5  # +10%
    failure_threshold: 102  # +20%
  
  memory_usage:
    baseline: 128  # MB
    warning_threshold: 140  # +10%
    failure_threshold: 153  # +20%
  
  context_switches:
    baseline: 12000  # per second
    warning_threshold: 13200  # +10%
    failure_threshold: 14400  # +20%
  
  system_calls:
    baseline: 45000  # per second
    warning_threshold: 49500  # +10%
    failure_threshold: 54000  # +20%

# 回归检测阈值
thresholds:
  # 吞吐量阈值（下降百分比）
  rps:
    warning: 0.10  # 10% 下降触发警告
    failure: 0.10  # 10% 下降触发失败
  
  # 延迟阈值（增加百分比）
  latency:
    warning: 0.10  # 10% 增加触发警告
    failure: 0.20  # 20% 增加触发失败
  
  # 资源使用阈值（增加百分比）
  resources:
    warning: 0.10  # 10% 增加触发警告
    failure: 0.20  # 20% 增加触发失败
  
  # 错误率阈值
  errors:
    warning: 0  # 任何错误触发警告
    failure: 0  # 任何错误触发失败

# 测试配置
test_config:
  # 每个场景运行次数
  iterations:
    low_concurrent: 5
    medium_concurrent: 5
    high_concurrent: 5
    extreme_concurrent: 3
    very_high_concurrent: 3
    sustained_load: 1
    small_file: 3
    large_file: 3
  
  # 测试持续时间（秒）
  duration:
    low_concurrent: 10
    medium_concurrent: 10
    high_concurrent: 10
    extreme_concurrent: 30
    very_high_concurrent: 30
    sustained_load: 60
    small_file: 10
    large_file: 10
  
  # 连接数
  connections:
    low_concurrent: 10
    medium_concurrent: 50
    high_concurrent: 100
    extreme_concurrent: 500
    very_high_concurrent: 1000
    sustained_load: 100
    small_file: 100
    large_file: 50
  
  # 线程数
  threads:
    low_concurrent: 4
    medium_concurrent: 4
    high_concurrent: 4
    extreme_concurrent: 8
    very_high_concurrent: 8
    sustained_load: 4
    small_file: 4
    large_file: 4
  
  # 超时时间（秒）
  timeout:
    low_concurrent: 5
    medium_concurrent: 5
    high_concurrent: 5
    extreme_concurrent: 10
    very_high_concurrent: 10
    sustained_load: 5
    small_file: 5
    large_file: 10

# 数据保留配置
retention:
  # GitHub Actions artifacts 保留天数
  artifacts: 90  # days
  
  # GitHub Releases 保留数量
  releases: 30  # count
  
  # 历史数据保留天数
  historical_data: 180  # days
  
  # 趋势图保留天数
  trend_charts: 90  # days

# 报告配置
report:
  # 报告格式
  formats:
    - markdown
    - json
  
  # 报告内容
  sections:
    - test_overview
    - test_environment
    - test_summary
    - detailed_results
    - resource_usage
    - performance_trends
    - regression_analysis
    - recommendations
    - appendix
  
  # 趋势图配置
  charts:
    - throughput_trends
    - latency_trends
    - p99_latency_trends
    - resource_usage_trends
  
  # 性能仪表板
  dashboard:
    update_interval: daily  # daily, weekly, monthly
    trend_periods:
      - 7  # 7 days
      - 30  # 30 days
      - 90  # 90 days

# 通知配置
notifications:
  # 回归检测通知
  regression:
    enabled: true
    channels:
      - github_issue
      - pull_request_comment
    
    # 严重级别
    severity:
      - failure
      - warning
  
  # 性能改进通知
  improvement:
    enabled: true
    channels:
      - github_issue
    
    # 最小改进百分比
    min_improvement: 0.05  # 5%

# CI/CD 集成配置
ci_cd:
  # 触发条件
  triggers:
    - schedule  # 每日定时运行
    - workflow_dispatch  # 手动触发
    - pull_request  # PR 触发
  
  # 阻止合并
  block_merge:
    enabled: true
    conditions:
      - regression_failure  # 检测到回归失败时阻止
  
  # 里程碑
  milestones:
    - daily  # 每日基准测试
    - release  # 发布前基准测试
    - feature  # 功能分支基准测试