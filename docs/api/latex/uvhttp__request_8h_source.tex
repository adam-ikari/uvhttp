\hypertarget{uvhttp__request_8h_source}{}\doxysection{uvhttp\+\_\+request.\+h}
\label{uvhttp__request_8h_source}\index{include/uvhttp\_request.h@{include/uvhttp\_request.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef UVHTTP\_REQUEST\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define UVHTTP\_REQUEST\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}uvhttp\_common.h"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}uvhttp\_error.h"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}uvhttp\_platform.h"{}}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}llhttp.h"{}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <stddef.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <uv.h>}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{17 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define MAX\_URL\_LEN 2048}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define MAX\_BODY\_LEN (1024 * 1024)  }\textcolor{comment}{// 1MB}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{comment}{// HTTP方法枚举}}
\DoxyCodeLine{24 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{25     UVHTTP\_ANY = 0,}
\DoxyCodeLine{26     UVHTTP\_GET,}
\DoxyCodeLine{27     UVHTTP\_POST,}
\DoxyCodeLine{28     UVHTTP\_PUT,}
\DoxyCodeLine{29     UVHTTP\_DELETE,}
\DoxyCodeLine{30     UVHTTP\_HEAD,}
\DoxyCodeLine{31     UVHTTP\_OPTIONS,}
\DoxyCodeLine{32     UVHTTP\_PATCH}
\DoxyCodeLine{33 \} uvhttp\_method\_t;}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request}} \mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}};}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request}} \{}
\DoxyCodeLine{38     \textcolor{comment}{/* ========== 缓存行1（0-\/63字节）：热路径字段 -\/ 最频繁访问 ========== */}}
\DoxyCodeLine{39     \textcolor{comment}{/* 在 HTTP 解析、路由匹配中频繁访问 */}}
\DoxyCodeLine{40     uvhttp\_method\_t method; \textcolor{comment}{/* 4 字节 -\/ HTTP 方法 */}}
\DoxyCodeLine{41     \textcolor{keywordtype}{int} parsing\_complete;   \textcolor{comment}{/* 4 字节 -\/ 解析是否完成 */}}
\DoxyCodeLine{42     \textcolor{keywordtype}{int} \_padding1[2];       \textcolor{comment}{/* 8 字节 -\/ 填充到16字节 */}}
\DoxyCodeLine{43     \textcolor{keywordtype}{size\_t} header\_count;    \textcolor{comment}{/* 8 字节 -\/ header 数量 */}}
\DoxyCodeLine{44     \textcolor{keywordtype}{size\_t} body\_length;     \textcolor{comment}{/* 8 字节 -\/ body 长度 */}}
\DoxyCodeLine{45     \textcolor{keywordtype}{size\_t} body\_capacity;   \textcolor{comment}{/* 8 字节 -\/ body 容量 */}}
\DoxyCodeLine{46     uv\_tcp\_t* client;       \textcolor{comment}{/* 8 字节 -\/ TCP 客户端句柄 */}}
\DoxyCodeLine{47     llhttp\_t* parser;       \textcolor{comment}{/* 8 字节 -\/ HTTP 解析器 */}}
\DoxyCodeLine{48     \textcolor{comment}{/* 缓存行1总计：56字节（剩余8字节填充） */}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{comment}{/* ========== 缓存行2（64-\/127字节）：指针字段 -\/ 次频繁访问 ========== */}}
\DoxyCodeLine{51     \textcolor{comment}{/* 在请求处理、响应构建中频繁访问 */}}
\DoxyCodeLine{52     llhttp\_settings\_t* parser\_settings; \textcolor{comment}{/* 8 字节 -\/ 解析器设置 */}}
\DoxyCodeLine{53     \textcolor{keywordtype}{char}* path;                         \textcolor{comment}{/* 8 字节 -\/ 请求路径 */}}
\DoxyCodeLine{54     \textcolor{keywordtype}{char}* query;                        \textcolor{comment}{/* 8 字节 -\/ 查询字符串 */}}
\DoxyCodeLine{55     \textcolor{keywordtype}{char}* body;                         \textcolor{comment}{/* 8 字节 -\/ 请求体 */}}
\DoxyCodeLine{56     \textcolor{keywordtype}{void}* user\_data;                    \textcolor{comment}{/* 8 字节 -\/ 用户数据 */}}
\DoxyCodeLine{57     \mbox{\hyperlink{structuvhttp__header__t}{uvhttp\_header\_t}}* headers\_extra; \textcolor{comment}{/* 8 字节 -\/ 额外 headers（动态扩容） */}}
\DoxyCodeLine{58     \textcolor{keywordtype}{size\_t} headers\_capacity;        \textcolor{comment}{/* 8 字节 -\/ headers 总容量 */}}
\DoxyCodeLine{59     \textcolor{keywordtype}{int} \_padding2[2];               \textcolor{comment}{/* 8 字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{60     \textcolor{comment}{/* 缓存行2总计：64字节 */}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     \textcolor{comment}{/* ========== 缓存行3+（128+字节）：大块缓冲区 ========== */}}
\DoxyCodeLine{63     \textcolor{comment}{/* 放在最后，避免影响热路径字段的缓存局部性 */}}
\DoxyCodeLine{64     \textcolor{keywordtype}{char} url[MAX\_URL\_LEN]; \textcolor{comment}{/* 2048 字节 -\/ URL 缓冲区 */}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     \textcolor{comment}{/* Headers -\/ 混合分配：内联 + 动态扩容（优化内存局部性） */}}
\DoxyCodeLine{67     \mbox{\hyperlink{structuvhttp__header__t}{uvhttp\_header\_t}}}
\DoxyCodeLine{68         headers[\mbox{\hyperlink{uvhttp__constants_8h_abab5c4bf7dbfb9cc7a120f4b52c923fa}{UVHTTP\_INLINE\_HEADERS\_CAPACITY}}]; \textcolor{comment}{/* 内联，减少动态分配 */}}
\DoxyCodeLine{69 \};}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{comment}{/* ========== 内存布局验证静态断言 ========== */}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{comment}{/* 验证指针对齐（平台自适应） */}}
\DoxyCodeLine{74 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, client, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{75 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, parser, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{76 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, parser\_settings,}
\DoxyCodeLine{77                        UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{78 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, path, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{79 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, query, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{80 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, body, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82 \textcolor{comment}{/* 验证size\_t对齐（平台自适应） */}}
\DoxyCodeLine{83 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, header\_count, UVHTTP\_SIZE\_T\_ALIGNMENT);}
\DoxyCodeLine{84 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, body\_length, UVHTTP\_SIZE\_T\_ALIGNMENT);}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{comment}{/* 验证大型缓冲区在结构体末尾 */}}
\DoxyCodeLine{87 UVHTTP\_STATIC\_ASSERT(offsetof(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, url) >= 64,}
\DoxyCodeLine{88                      \textcolor{stringliteral}{"{}url buffer should be after first 64 bytes"{}});}
\DoxyCodeLine{89 UVHTTP\_STATIC\_ASSERT(offsetof(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}, headers) >= 64,}
\DoxyCodeLine{90                      \textcolor{stringliteral}{"{}headers array should be after first 64 bytes"{}});}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \textcolor{comment}{/* API functions */}}
\DoxyCodeLine{93 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_method(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{94 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_url(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{95 \textcolor{keywordtype}{void} uvhttp\_request\_free(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{96 \textcolor{keywordtype}{void} uvhttp\_request\_cleanup(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{97 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_path(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{98 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_query\_string(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{99 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_query\_param(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request,}
\DoxyCodeLine{100                                            \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name);}
\DoxyCodeLine{101 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_client\_ip(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{102 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_header(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request,}
\DoxyCodeLine{103                                       \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name);}
\DoxyCodeLine{104 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_request\_get\_body(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{105 \textcolor{keywordtype}{size\_t} uvhttp\_request\_get\_body\_length(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{106 }
\DoxyCodeLine{107 \textcolor{comment}{/* ========== Headers 操作 API ========== */}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{comment}{/* 获取 header 数量 */}}
\DoxyCodeLine{110 \textcolor{keywordtype}{size\_t} uvhttp\_request\_get\_header\_count(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 \textcolor{comment}{/* 获取指定索引的 header（内部使用） */}}
\DoxyCodeLine{113 \mbox{\hyperlink{structuvhttp__header__t}{uvhttp\_header\_t}}* uvhttp\_request\_get\_header\_at(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request,}
\DoxyCodeLine{114                                               \textcolor{keywordtype}{size\_t} index);}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \textcolor{comment}{/* 添加 header（内部使用，自动扩容） */}}
\DoxyCodeLine{117 uvhttp\_error\_t uvhttp\_request\_add\_header(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request,}
\DoxyCodeLine{118                                          \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* value);}
\DoxyCodeLine{119 }
\DoxyCodeLine{120 \textcolor{comment}{/* 遍历所有 headers */}}
\DoxyCodeLine{121 \textcolor{keyword}{typedef} void (*uvhttp\_header\_callback\_t)(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* name, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* value,}
\DoxyCodeLine{122                                          \textcolor{keywordtype}{void}* user\_data);}
\DoxyCodeLine{123 \textcolor{keywordtype}{void} uvhttp\_request\_foreach\_header(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request,}
\DoxyCodeLine{124                                    uvhttp\_header\_callback\_t callback,}
\DoxyCodeLine{125                                    \textcolor{keywordtype}{void}* user\_data);}
\DoxyCodeLine{126 }
\DoxyCodeLine{127 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{128 \}}
\DoxyCodeLine{129 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* UVHTTP\_REQUEST\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
