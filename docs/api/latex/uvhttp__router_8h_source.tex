\hypertarget{uvhttp__router_8h_source}{}\doxysection{uvhttp\+\_\+router.\+h}
\label{uvhttp__router_8h_source}\index{include/uvhttp\_router.h@{include/uvhttp\_router.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef UVHTTP\_ROUTER\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define UVHTTP\_ROUTER\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}uvhttp\_common.h"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{uvhttp__constants_8h}{uvhttp\_constants.h}}"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}uvhttp\_error.h"{}}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}uvhttp\_platform.h"{}}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}uvhttp\_request.h"{}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <stddef.h>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{comment}{// Forward declarations}}
\DoxyCodeLine{14 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__response}{uvhttp\_response}} \mbox{\hyperlink{structuvhttp__response}{uvhttp\_response\_t}};}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{comment}{// HTTP方法枚举 -\/ 使用uvhttp\_request.h中的定义}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{19 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#define MAX\_ROUTES 128}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#define MAX\_ROUTE\_PATH\_LEN 256}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define MAX\_PARAMS 16}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define MAX\_PARAM\_NAME\_LEN 64}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#define MAX\_PARAM\_VALUE\_LEN 256}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{comment}{// 路由参数}}
\DoxyCodeLine{29 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{30     \textcolor{keywordtype}{char} name[MAX\_PARAM\_NAME\_LEN];}
\DoxyCodeLine{31     \textcolor{keywordtype}{char} value[MAX\_PARAM\_VALUE\_LEN];}
\DoxyCodeLine{32 \} \mbox{\hyperlink{structuvhttp__param__t}{uvhttp\_param\_t}};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{comment}{// 路由匹配结果}}
\DoxyCodeLine{35 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{36     uvhttp\_request\_handler\_t handler;}
\DoxyCodeLine{37     \mbox{\hyperlink{structuvhttp__param__t}{uvhttp\_param\_t}} params[MAX\_PARAMS];}
\DoxyCodeLine{38     \textcolor{keywordtype}{size\_t} param\_count;}
\DoxyCodeLine{39 \} \mbox{\hyperlink{structuvhttp__route__match__t}{uvhttp\_route\_match\_t}};}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{comment}{// 路由节点}}
\DoxyCodeLine{42 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__route__node}{uvhttp\_route\_node}} \{}
\DoxyCodeLine{43     \textcolor{keywordtype}{char} segment[64];  \textcolor{comment}{// 路径段}}
\DoxyCodeLine{44     uvhttp\_method\_t method;}
\DoxyCodeLine{45     uvhttp\_request\_handler\_t handler;}
\DoxyCodeLine{46     \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__route__node}{uvhttp\_route\_node}}* children[UVHTTP\_ROUTER\_MAX\_CHILDREN];  \textcolor{comment}{// 子节点}}
\DoxyCodeLine{47     \textcolor{keywordtype}{size\_t} child\_count;}
\DoxyCodeLine{48     \textcolor{keywordtype}{int} is\_param;                         \textcolor{comment}{// 是否参数节点}}
\DoxyCodeLine{49     \textcolor{keywordtype}{char} param\_name[MAX\_PARAM\_NAME\_LEN];  \textcolor{comment}{// 参数名}}
\DoxyCodeLine{50 \} \mbox{\hyperlink{structuvhttp__route__node}{uvhttp\_route\_node\_t}};}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{comment}{// 数组路由结构}}
\DoxyCodeLine{53 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{54     \textcolor{keywordtype}{char} path[MAX\_ROUTE\_PATH\_LEN];}
\DoxyCodeLine{55     uvhttp\_method\_t method;}
\DoxyCodeLine{56     uvhttp\_request\_handler\_t handler;}
\DoxyCodeLine{57 \} \mbox{\hyperlink{structarray__route__t}{array\_route\_t}};}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{comment}{// 路由器结构}}
\DoxyCodeLine{60 \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router}} \{}
\DoxyCodeLine{61     \textcolor{comment}{/* 热路径字段（频繁访问）-\/ 优化内存局部性 */}}
\DoxyCodeLine{62     \textcolor{keywordtype}{int} use\_trie;       \textcolor{comment}{/* 4 字节 -\/ 是否使用Trie */}}
\DoxyCodeLine{63     \textcolor{keywordtype}{size\_t} route\_count; \textcolor{comment}{/* 8 字节 -\/ 总路由数量 */}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{comment}{/* Trie路由相关（8字节对齐） */}}
\DoxyCodeLine{66     \mbox{\hyperlink{structuvhttp__route__node}{uvhttp\_route\_node\_t}}* root;      \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{67     \mbox{\hyperlink{structuvhttp__route__node}{uvhttp\_route\_node\_t}}* node\_pool; \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{68     \textcolor{keywordtype}{size\_t} node\_pool\_size;          \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{69     \textcolor{keywordtype}{size\_t} node\_pool\_used;          \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \textcolor{comment}{/* 数组路由相关（8字节对齐） */}}
\DoxyCodeLine{72     \mbox{\hyperlink{structarray__route__t}{array\_route\_t}}* array\_routes; \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{73     \textcolor{keywordtype}{size\_t} array\_route\_count;    \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{74     \textcolor{keywordtype}{size\_t} array\_capacity;       \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     \textcolor{comment}{/* 静态文件路由支持（8字节对齐） */}}
\DoxyCodeLine{77     \textcolor{keywordtype}{char}* static\_prefix;                     \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{78     \textcolor{keywordtype}{void}* static\_context;                    \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{79     uvhttp\_request\_handler\_t static\_handler; \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81     \textcolor{comment}{/* 回退路由支持（8字节对齐） */}}
\DoxyCodeLine{82     \textcolor{keywordtype}{void}* fallback\_context;                    \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{83     uvhttp\_request\_handler\_t fallback\_handler; \textcolor{comment}{/* 8 字节 */}}
\DoxyCodeLine{84 \};}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router}} \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}};}
\DoxyCodeLine{87 }
\DoxyCodeLine{88 \textcolor{comment}{/* ========== 内存布局验证静态断言 ========== */}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{comment}{/* 验证指针对齐（平台自适应） */}}
\DoxyCodeLine{91 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, root, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{92 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, node\_pool, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{93 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, array\_routes, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{94 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, static\_prefix,}
\DoxyCodeLine{95                        UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{96 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, static\_context,}
\DoxyCodeLine{97                        UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{comment}{/* 验证size\_t对齐（平台自适应） */}}
\DoxyCodeLine{100 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, route\_count, UVHTTP\_SIZE\_T\_ALIGNMENT);}
\DoxyCodeLine{101 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}, node\_pool\_size,}
\DoxyCodeLine{102                        UVHTTP\_SIZE\_T\_ALIGNMENT);}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 \textcolor{comment}{/* 路由API函数 */}}
\DoxyCodeLine{113 uvhttp\_error\_t uvhttp\_router\_new(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}** router);}
\DoxyCodeLine{114 \textcolor{keywordtype}{void} uvhttp\_router\_free(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router);}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 \textcolor{comment}{/* 路由添加（支持HTTP方法） */}}
\DoxyCodeLine{117 uvhttp\_error\_t uvhttp\_router\_add\_route(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router,}
\DoxyCodeLine{118                                        \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{119                                        uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{120 uvhttp\_error\_t uvhttp\_router\_add\_route\_method(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router,}
\DoxyCodeLine{121                                               \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{122                                               uvhttp\_method\_t method,}
\DoxyCodeLine{123                                               uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \textcolor{comment}{/* 路由查找 */}}
\DoxyCodeLine{126 uvhttp\_request\_handler\_t uvhttp\_router\_find\_handler(}
\DoxyCodeLine{127     \textcolor{keyword}{const} \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* method);}
\DoxyCodeLine{128 }
\DoxyCodeLine{129 \textcolor{comment}{/* 路由匹配（获取参数） */}}
\DoxyCodeLine{130 uvhttp\_error\_t uvhttp\_router\_match(\textcolor{keyword}{const} \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router,}
\DoxyCodeLine{131                                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* method,}
\DoxyCodeLine{132                                    \mbox{\hyperlink{structuvhttp__route__match__t}{uvhttp\_route\_match\_t}}* match);}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 \textcolor{comment}{/* 参数解析 */}}
\DoxyCodeLine{135 uvhttp\_error\_t uvhttp\_parse\_path\_params(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{136                                         \mbox{\hyperlink{structuvhttp__param__t}{uvhttp\_param\_t}}* params,}
\DoxyCodeLine{137                                         \textcolor{keywordtype}{size\_t}* param\_count);}
\DoxyCodeLine{138 }
\DoxyCodeLine{139 \textcolor{comment}{/* 方法字符串转换 */}}
\DoxyCodeLine{140 uvhttp\_method\_t uvhttp\_method\_from\_string(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* method);}
\DoxyCodeLine{141 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_method\_to\_string(uvhttp\_method\_t method);}
\DoxyCodeLine{142 }
\DoxyCodeLine{143 \textcolor{comment}{/* 静态文件路由支持 */}}
\DoxyCodeLine{144 uvhttp\_error\_t uvhttp\_router\_add\_static\_route(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router,}
\DoxyCodeLine{145                                               \textcolor{keyword}{const} \textcolor{keywordtype}{char}* prefix\_path,}
\DoxyCodeLine{146                                               \textcolor{keywordtype}{void}* static\_context);}
\DoxyCodeLine{147 }
\DoxyCodeLine{148 \textcolor{comment}{/* 回退路由支持 */}}
\DoxyCodeLine{149 uvhttp\_error\_t uvhttp\_router\_add\_fallback\_route(\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router,}
\DoxyCodeLine{150                                                 \textcolor{keywordtype}{void}* static\_context);}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{153 \}}
\DoxyCodeLine{154 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{155 }
\DoxyCodeLine{156 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* UVHTTP\_ROUTER\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
