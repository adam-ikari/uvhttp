\hypertarget{uvhttp__server_8h_source}{}\doxysection{uvhttp\+\_\+server.\+h}
\label{uvhttp__server_8h_source}\index{include/uvhttp\_server.h@{include/uvhttp\_server.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef UVHTTP\_SERVER\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define UVHTTP\_SERVER\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{uvhttp__allocator_8h}{uvhttp\_allocator.h}}"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}uvhttp\_common.h"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{uvhttp__config_8h}{uvhttp\_config.h}}"{}}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}uvhttp\_error.h"{}}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}uvhttp\_platform.h"{}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <uv.h>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{comment}{/* 包含 uthash 头文件用于哈希表实现 */}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}uthash.h"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{comment}{/* 白名单哈希表项 */}}
\DoxyCodeLine{17 \textcolor{keyword}{struct }\mbox{\hyperlink{structwhitelist__item}{whitelist\_item}} \{}
\DoxyCodeLine{18     \textcolor{keywordtype}{char} ip[INET\_ADDRSTRLEN];}
\DoxyCodeLine{19     UT\_hash\_handle hh;}
\DoxyCodeLine{20 \};}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}uvhttp\_features.h"{}}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{comment}{// Forward declarations}}
\DoxyCodeLine{24 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request}} \mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}};}
\DoxyCodeLine{25 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__response}{uvhttp\_response}} \mbox{\hyperlink{structuvhttp__response}{uvhttp\_response\_t}};}
\DoxyCodeLine{26 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__router}{uvhttp\_router}} \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}};}
\DoxyCodeLine{27 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__connection}{uvhttp\_connection}} \mbox{\hyperlink{structuvhttp__connection}{uvhttp\_connection\_t}};}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_TLS}}
\DoxyCodeLine{30 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__tls__context}{uvhttp\_tls\_context}} \mbox{\hyperlink{structuvhttp__tls__context}{uvhttp\_tls\_context\_t}};}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_WEBSOCKET}}
\DoxyCodeLine{34 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }uvhttp\_ws\_connection uvhttp\_ws\_connection\_t;}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{comment}{/* WebSocket 连接节点 */}}
\DoxyCodeLine{37 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structws__connection__node}{ws\_connection\_node}} \{}
\DoxyCodeLine{38     uvhttp\_ws\_connection\_t* ws\_conn;}
\DoxyCodeLine{39     \textcolor{keywordtype}{char} path[4096];}
\DoxyCodeLine{40     uint64\_t last\_activity;  \textcolor{comment}{/* 最后活动时间（毫秒） */}}
\DoxyCodeLine{41     uint64\_t last\_ping\_sent; \textcolor{comment}{/* 最后发送 Ping 的时间（毫秒） */}}
\DoxyCodeLine{42     \textcolor{keywordtype}{int} ping\_pending;        \textcolor{comment}{/* 是否有待处理的 Ping */}}
\DoxyCodeLine{43     \textcolor{keyword}{struct }\mbox{\hyperlink{structws__connection__node}{ws\_connection\_node}}* next;}
\DoxyCodeLine{44 \} \mbox{\hyperlink{structws__connection__node}{ws\_connection\_node\_t}};}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{comment}{/* WebSocket 连接管理器 */}}
\DoxyCodeLine{47 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{48     \mbox{\hyperlink{structws__connection__node}{ws\_connection\_node\_t}}* connections; \textcolor{comment}{/* 连接链表 */}}
\DoxyCodeLine{49     \textcolor{keywordtype}{int} connection\_count;              \textcolor{comment}{/* 连接计数 */}}
\DoxyCodeLine{50     uv\_timer\_t timeout\_timer;          \textcolor{comment}{/* 超时检测定时器 */}}
\DoxyCodeLine{51     uv\_timer\_t heartbeat\_timer;        \textcolor{comment}{/* 心跳检测定时器 */}}
\DoxyCodeLine{52     \textcolor{keywordtype}{int} timeout\_seconds;               \textcolor{comment}{/* 超时时间（秒） */}}
\DoxyCodeLine{53     \textcolor{keywordtype}{int} heartbeat\_interval;            \textcolor{comment}{/* 心跳间隔（秒） */}}
\DoxyCodeLine{54     uint64\_t ping\_timeout\_ms;          \textcolor{comment}{/* Ping 超时时间（毫秒） */}}
\DoxyCodeLine{55     \textcolor{keywordtype}{int} enabled;                       \textcolor{comment}{/* 是否启用连接管理 */}}
\DoxyCodeLine{56     \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server}}* server;      \textcolor{comment}{/* 所属服务器 */}}
\DoxyCodeLine{57 \} \mbox{\hyperlink{structws__connection__manager__t}{ws\_connection\_manager\_t}};}
\DoxyCodeLine{58 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{61 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{62 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{preprocessor}{\#define MAX\_CONNECTIONS 1000}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server}} \mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}};}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{comment}{/* 服务器构建器结构体（统一API） */}}
\DoxyCodeLine{69 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{70     \mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server;}
\DoxyCodeLine{71     \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router;}
\DoxyCodeLine{72     \mbox{\hyperlink{structuvhttp__config__t}{uvhttp\_config\_t}}* config;}
\DoxyCodeLine{73     uv\_loop\_t* loop;}
\DoxyCodeLine{74     \textcolor{keywordtype}{int} auto\_cleanup;}
\DoxyCodeLine{75 \} \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}};}
\DoxyCodeLine{76 \textcolor{comment}{/* ========== 超时统计回调 ========== */}}
\DoxyCodeLine{82 \textcolor{keyword}{typedef} void (*uvhttp\_timeout\_callback\_t)(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{83                                           \mbox{\hyperlink{structuvhttp__connection}{uvhttp\_connection\_t}}* conn,}
\DoxyCodeLine{84                                           uint64\_t timeout\_ms, \textcolor{keywordtype}{void}* user\_data);}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server}} \{}
\DoxyCodeLine{87     \textcolor{comment}{/* ========== 缓存行1（0-\/63字节）：热路径字段 -\/ 最频繁访问 ========== */}}
\DoxyCodeLine{88     \textcolor{comment}{/* 在 on\_connection、连接管理中频繁访问 */}}
\DoxyCodeLine{89     \textcolor{keywordtype}{int} is\_listening;                 \textcolor{comment}{/* 4 字节 -\/ 是否正在监听 */}}
\DoxyCodeLine{90     \textcolor{keywordtype}{int} owns\_loop;                    \textcolor{comment}{/* 4 字节 -\/ 是否拥有循环 */}}
\DoxyCodeLine{91     \textcolor{keywordtype}{int} \_padding1[2];                 \textcolor{comment}{/* 8 字节 -\/ 填充到16字节 */}}
\DoxyCodeLine{92     \textcolor{keywordtype}{size\_t} active\_connections;        \textcolor{comment}{/* 8 字节 -\/ 活跃连接数 */}}
\DoxyCodeLine{93     \textcolor{keywordtype}{size\_t} max\_connections;           \textcolor{comment}{/* 8 字节 -\/ 最大连接数 */}}
\DoxyCodeLine{94     \textcolor{keywordtype}{size\_t} max\_message\_size;          \textcolor{comment}{/* 8 字节 -\/ 最大消息大小 */}}
\DoxyCodeLine{95     uvhttp\_request\_handler\_t handler; \textcolor{comment}{/* 8 字节 -\/ 请求处理器 */}}
\DoxyCodeLine{96     uvhttp\_timeout\_callback\_t timeout\_callback; \textcolor{comment}{/* 8 字节 -\/ 超时统计回调 */}}
\DoxyCodeLine{97     \textcolor{keywordtype}{void}* timeout\_callback\_user\_data; \textcolor{comment}{/* 8 字节 -\/ 回调用户数据 */}}
\DoxyCodeLine{98     \textcolor{comment}{/* 缓存行1总计：64字节 */}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \textcolor{comment}{/* ========== 缓存行2（64-\/127字节）：核心指针字段 -\/ 次频繁访问 ========== */}}
\DoxyCodeLine{101     \textcolor{comment}{/* 在服务器初始化、请求路由中频繁访问 */}}
\DoxyCodeLine{102     uv\_loop\_t* loop;                \textcolor{comment}{/* 8 字节 -\/ 事件循环 */}}
\DoxyCodeLine{103     \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router;        \textcolor{comment}{/* 8 字节 -\/ 路由器 */}}
\DoxyCodeLine{104     \mbox{\hyperlink{structuvhttp__config__t}{uvhttp\_config\_t}}* config;        \textcolor{comment}{/* 8 字节 -\/ 配置 */}}
\DoxyCodeLine{105     \textcolor{keyword}{struct }\mbox{\hyperlink{structuvhttp__context}{uvhttp\_context}}* context; \textcolor{comment}{/* 8 字节 -\/ 应用上下文 */}}
\DoxyCodeLine{106     \textcolor{keywordtype}{void}* user\_data;                \textcolor{comment}{/* 8 字节 -\/ 应用数据 */}}
\DoxyCodeLine{107 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_TLS}}
\DoxyCodeLine{108     \mbox{\hyperlink{structuvhttp__tls__context}{uvhttp\_tls\_context\_t}}* tls\_ctx; \textcolor{comment}{/* 8 字节 -\/ TLS 上下文 */}}
\DoxyCodeLine{109     \textcolor{keywordtype}{int} tls\_enabled;               \textcolor{comment}{/* 4 字节 -\/ TLS 是否启用 */}}
\DoxyCodeLine{110     \textcolor{keywordtype}{int} \_padding2[3];              \textcolor{comment}{/* 12字节 -\/ 填充到16字节 */}}
\DoxyCodeLine{111 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{112     \textcolor{keywordtype}{int} \_padding2[4];  \textcolor{comment}{/* 16字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{113 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{114     \textcolor{comment}{/* 缓存行2总计：约64字节（取决于 TLS 是否启用） */}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116     \textcolor{comment}{/* ========== 缓存行3（128-\/191字节）：libuv 句柄 ========== */}}
\DoxyCodeLine{117     \textcolor{comment}{/* libuv 内部结构体，大小固定 */}}
\DoxyCodeLine{118     uv\_tcp\_t tcp\_handle; \textcolor{comment}{/* 约40-\/48字节 */}}
\DoxyCodeLine{119     \textcolor{keywordtype}{int} \_padding3[3];    \textcolor{comment}{/* 12字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{120     \textcolor{comment}{/* 缓存行3总计：约64字节 */}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{comment}{/* ========== 缓存行4（192-\/255字节）：WebSocket 相关 ========== */}}
\DoxyCodeLine{123 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_WEBSOCKET}}
\DoxyCodeLine{124     \textcolor{keywordtype}{void}* ws\_routes; \textcolor{comment}{/* 8 字节 -\/ WebSocket 路由表（已废弃） */}}
\DoxyCodeLine{125     \mbox{\hyperlink{structws__connection__manager__t}{ws\_connection\_manager\_t}}*}
\DoxyCodeLine{126         ws\_connection\_manager; \textcolor{comment}{/* 8 字节 -\/ WebSocket 连接管理器 */}}
\DoxyCodeLine{127     \textcolor{keywordtype}{int} \_padding4[12];         \textcolor{comment}{/* 48字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{128 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{129     \textcolor{keywordtype}{int} \_padding4[16]; \textcolor{comment}{/* 64字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{130 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{131     \textcolor{comment}{/* 缓存行4总计：64字节 */}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{comment}{/* ========== 缓存行5-\/6（256-\/383字节）：限流功能 ========== */}}
\DoxyCodeLine{134 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_RATE\_LIMIT}}
\DoxyCodeLine{135     \textcolor{keywordtype}{int} rate\_limit\_enabled;        \textcolor{comment}{/* 4 字节 -\/ 限流是否启用 */}}
\DoxyCodeLine{136     \textcolor{keywordtype}{int} rate\_limit\_max\_requests;   \textcolor{comment}{/* 4 字节 -\/ 最大请求数 */}}
\DoxyCodeLine{137     \textcolor{keywordtype}{int} rate\_limit\_window\_seconds; \textcolor{comment}{/* 4 字节 -\/ 时间窗口（秒） */}}
\DoxyCodeLine{138     \textcolor{keywordtype}{int} rate\_limit\_request\_count;  \textcolor{comment}{/* 4 字节 -\/ 当前请求数 */}}
\DoxyCodeLine{139     uint64\_t rate\_limit\_window\_start\_time; \textcolor{comment}{/* 8 字节 -\/ 窗口开始时间 */}}
\DoxyCodeLine{140     \textcolor{keywordtype}{void}** rate\_limit\_whitelist;           \textcolor{comment}{/* 8 字节 -\/ 白名单数组 */}}
\DoxyCodeLine{141     \textcolor{keywordtype}{size\_t} rate\_limit\_whitelist\_count;     \textcolor{comment}{/* 8 字节 -\/ 白名单数量 */}}
\DoxyCodeLine{142     \textcolor{keyword}{struct }\mbox{\hyperlink{structwhitelist__item}{whitelist\_item}}*}
\DoxyCodeLine{143         rate\_limit\_whitelist\_hash; \textcolor{comment}{/* 8 字节 -\/ 白名单哈希表 */}}
\DoxyCodeLine{144     \textcolor{keywordtype}{int} \_padding5[8];              \textcolor{comment}{/* 32字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{145 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{146     \textcolor{keywordtype}{int} \_padding5[16]; \textcolor{comment}{/* 64字节 -\/ 填充到64字节 */}}
\DoxyCodeLine{147 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{148     \textcolor{comment}{/* 缓存行5总计：64字节 */}}
\DoxyCodeLine{149 \};}
\DoxyCodeLine{150 }
\DoxyCodeLine{151 \textcolor{comment}{/* ========== 内存布局验证静态断言 ========== */}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 \textcolor{comment}{/* 验证指针对齐（平台自适应） */}}
\DoxyCodeLine{154 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}, loop, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{155 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}, router, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{156 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}, config, UVHTTP\_POINTER\_ALIGNMENT);}
\DoxyCodeLine{157 }
\DoxyCodeLine{158 \textcolor{comment}{/* 验证size\_t对齐（平台自适应） */}}
\DoxyCodeLine{159 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}, active\_connections,}
\DoxyCodeLine{160                        UVHTTP\_SIZE\_T\_ALIGNMENT);}
\DoxyCodeLine{161 UVHTTP\_CHECK\_ALIGNMENT(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}, max\_connections,}
\DoxyCodeLine{162                        UVHTTP\_SIZE\_T\_ALIGNMENT);}
\DoxyCodeLine{163 }
\DoxyCodeLine{164 \textcolor{comment}{/* API函数 */}}
\DoxyCodeLine{174 uvhttp\_error\_t uvhttp\_server\_new(uv\_loop\_t* loop, \mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}** server);}
\DoxyCodeLine{175 uvhttp\_error\_t uvhttp\_server\_listen(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* host,}
\DoxyCodeLine{176                                     \textcolor{keywordtype}{int} port);}
\DoxyCodeLine{177 uvhttp\_error\_t uvhttp\_server\_stop(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{178 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_TLS}}
\DoxyCodeLine{179 uvhttp\_error\_t uvhttp\_server\_enable\_tls(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{180                                         \mbox{\hyperlink{structuvhttp__tls__context}{uvhttp\_tls\_context\_t}}* tls\_ctx);}
\DoxyCodeLine{181 uvhttp\_error\_t uvhttp\_server\_disable\_tls(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{182 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{183 uvhttp\_error\_t uvhttp\_server\_free(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{184 uvhttp\_error\_t uvhttp\_server\_set\_handler(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{185                                          uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{186 uvhttp\_error\_t uvhttp\_server\_set\_router(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{187                                         \mbox{\hyperlink{structuvhttp__router}{uvhttp\_router\_t}}* router);}
\DoxyCodeLine{188 uvhttp\_error\_t uvhttp\_server\_set\_context(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{189                                          \textcolor{keyword}{struct} \mbox{\hyperlink{structuvhttp__context}{uvhttp\_context}}* context);}
\DoxyCodeLine{190 }
\DoxyCodeLine{191 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_RATE\_LIMIT}}
\DoxyCodeLine{192 \textcolor{comment}{/* ========== 限流 API（核心功能） ========== */}}
\DoxyCodeLine{193 }
\DoxyCodeLine{209 uvhttp\_error\_t uvhttp\_server\_enable\_rate\_limit(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{210                                                \textcolor{keywordtype}{int} max\_requests,}
\DoxyCodeLine{211                                                \textcolor{keywordtype}{int} window\_seconds);}
\DoxyCodeLine{212 }
\DoxyCodeLine{219 uvhttp\_error\_t uvhttp\_server\_disable\_rate\_limit(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{220 }
\DoxyCodeLine{227 uvhttp\_error\_t uvhttp\_server\_check\_rate\_limit(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{228 }
\DoxyCodeLine{236 uvhttp\_error\_t uvhttp\_server\_add\_rate\_limit\_whitelist(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{237                                                       \textcolor{keyword}{const} \textcolor{keywordtype}{char}* client\_ip);}
\DoxyCodeLine{238 }
\DoxyCodeLine{252 uvhttp\_error\_t uvhttp\_server\_get\_rate\_limit\_status(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{253                                                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* client\_ip,}
\DoxyCodeLine{254                                                    \textcolor{keywordtype}{int}* remaining,}
\DoxyCodeLine{255                                                    uint64\_t* reset\_time);}
\DoxyCodeLine{256 }
\DoxyCodeLine{268 uvhttp\_error\_t uvhttp\_server\_reset\_rate\_limit\_client(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{269                                                      \textcolor{keyword}{const} \textcolor{keywordtype}{char}* client\_ip);}
\DoxyCodeLine{270 }
\DoxyCodeLine{277 uvhttp\_error\_t uvhttp\_server\_clear\_rate\_limit\_all(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{278 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* UVHTTP\_FEATURE\_RATE\_LIMIT */}\textcolor{preprocessor}{}}
\DoxyCodeLine{279 }
\DoxyCodeLine{280 \textcolor{comment}{/* ========== 统一API函数 ========== */}}
\DoxyCodeLine{281 }
\DoxyCodeLine{282 \textcolor{comment}{/* 快速创建和启动服务器 */}}
\DoxyCodeLine{291 uvhttp\_error\_t uvhttp\_server\_create(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* host, \textcolor{keywordtype}{int} port,}
\DoxyCodeLine{292                                     \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}** server);}
\DoxyCodeLine{293 }
\DoxyCodeLine{294 \textcolor{comment}{/* 链式路由API */}}
\DoxyCodeLine{295 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_get(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server,}
\DoxyCodeLine{296                                     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{297                                     uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{298 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_post(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server,}
\DoxyCodeLine{299                                      \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{300                                      uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{301 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_put(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server,}
\DoxyCodeLine{302                                     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{303                                     uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{304 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_delete(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server,}
\DoxyCodeLine{305                                        \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{306                                        uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{307 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_any(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server,}
\DoxyCodeLine{308                                     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{309                                     uvhttp\_request\_handler\_t handler);}
\DoxyCodeLine{310 }
\DoxyCodeLine{311 \textcolor{comment}{/* 简化配置API */}}
\DoxyCodeLine{312 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_set\_max\_connections(}
\DoxyCodeLine{313     \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server, \textcolor{keywordtype}{int} max\_conn);}
\DoxyCodeLine{314 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_set\_timeout(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server,}
\DoxyCodeLine{315                                             \textcolor{keywordtype}{int} timeout);}
\DoxyCodeLine{316 \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* uvhttp\_set\_max\_body\_size(}
\DoxyCodeLine{317     \mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server, \textcolor{keywordtype}{size\_t} size);}
\DoxyCodeLine{318 }
\DoxyCodeLine{319 \textcolor{comment}{/* 便捷请求参数获取 */}}
\DoxyCodeLine{320 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_get\_param(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name);}
\DoxyCodeLine{321 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_get\_header(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* name);}
\DoxyCodeLine{322 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* uvhttp\_get\_body(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{323 }
\DoxyCodeLine{324 \textcolor{comment}{/* 服务器运行和清理 */}}
\DoxyCodeLine{325 \textcolor{keywordtype}{int} uvhttp\_server\_run(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server);}
\DoxyCodeLine{326 \textcolor{keywordtype}{void} uvhttp\_server\_stop\_simple(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server);}
\DoxyCodeLine{327 \textcolor{keywordtype}{void} uvhttp\_server\_simple\_free(\mbox{\hyperlink{structuvhttp__server__builder__t}{uvhttp\_server\_builder\_t}}* server);}
\DoxyCodeLine{328 }
\DoxyCodeLine{329 \textcolor{comment}{/* 一键启动函数（最简API） */}}
\DoxyCodeLine{330 \textcolor{keywordtype}{int} uvhttp\_serve(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* host, \textcolor{keywordtype}{int} port);}
\DoxyCodeLine{331 }
\DoxyCodeLine{332 \textcolor{comment}{/* WebSocket API */}}
\DoxyCodeLine{333 \textcolor{preprocessor}{\#if UVHTTP\_FEATURE\_WEBSOCKET}}
\DoxyCodeLine{334 \textcolor{preprocessor}{\#    include "{}uvhttp\_websocket.h"{}}}
\DoxyCodeLine{335 }
\DoxyCodeLine{336 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{337     int (*on\_connect)(uvhttp\_ws\_connection\_t* ws\_conn);}
\DoxyCodeLine{338     int (*on\_message)(uvhttp\_ws\_connection\_t* ws\_conn, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* data,}
\DoxyCodeLine{339                       \textcolor{keywordtype}{size\_t} len, \textcolor{keywordtype}{int} opcode);}
\DoxyCodeLine{340     int (*on\_close)(uvhttp\_ws\_connection\_t* ws\_conn);}
\DoxyCodeLine{341     int (*on\_error)(uvhttp\_ws\_connection\_t* ws\_conn, \textcolor{keywordtype}{int} error\_code,}
\DoxyCodeLine{342                     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* error\_msg);}
\DoxyCodeLine{343     \textcolor{keywordtype}{void}* user\_data;}
\DoxyCodeLine{344     \textcolor{comment}{/* 超时统计回调 */}}
\DoxyCodeLine{345     uvhttp\_timeout\_callback\_t timeout\_callback; \textcolor{comment}{/* 8 字节 -\/ 超时统计回调 */}}
\DoxyCodeLine{346     \textcolor{keywordtype}{void}* timeout\_callback\_user\_data; \textcolor{comment}{/* 8 字节 -\/ 回调用户数据 */}}
\DoxyCodeLine{347 \} \mbox{\hyperlink{structuvhttp__ws__handler__t}{uvhttp\_ws\_handler\_t}};}
\DoxyCodeLine{348 }
\DoxyCodeLine{349 uvhttp\_error\_t uvhttp\_server\_register\_ws\_handler(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{350                                                  \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path,}
\DoxyCodeLine{351                                                  \mbox{\hyperlink{structuvhttp__ws__handler__t}{uvhttp\_ws\_handler\_t}}* handler);}
\DoxyCodeLine{352 uvhttp\_error\_t uvhttp\_server\_ws\_send(uvhttp\_ws\_connection\_t* ws\_conn,}
\DoxyCodeLine{353                                      \textcolor{keyword}{const} \textcolor{keywordtype}{char}* data, \textcolor{keywordtype}{size\_t} len);}
\DoxyCodeLine{354 uvhttp\_error\_t uvhttp\_server\_ws\_close(uvhttp\_ws\_connection\_t* ws\_conn, \textcolor{keywordtype}{int} code,}
\DoxyCodeLine{355                                       \textcolor{keyword}{const} \textcolor{keywordtype}{char}* reason);}
\DoxyCodeLine{356 }
\DoxyCodeLine{357 \textcolor{comment}{/* 内部函数 */}}
\DoxyCodeLine{358 \mbox{\hyperlink{structuvhttp__ws__handler__t}{uvhttp\_ws\_handler\_t}}* uvhttp\_server\_find\_ws\_handler(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{359                                                    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path);}
\DoxyCodeLine{360 }
\DoxyCodeLine{361 \textcolor{comment}{/* 连接管理 API */}}
\DoxyCodeLine{362 uvhttp\_error\_t uvhttp\_server\_ws\_enable\_connection\_management(}
\DoxyCodeLine{363     \mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server, \textcolor{keywordtype}{int} timeout\_seconds, \textcolor{keywordtype}{int} heartbeat\_interval);}
\DoxyCodeLine{364 }
\DoxyCodeLine{365 uvhttp\_error\_t uvhttp\_server\_ws\_disable\_connection\_management(}
\DoxyCodeLine{366     \mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{367 }
\DoxyCodeLine{368 \textcolor{keywordtype}{int} uvhttp\_server\_ws\_get\_connection\_count(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server);}
\DoxyCodeLine{369 }
\DoxyCodeLine{370 \textcolor{keywordtype}{int} uvhttp\_server\_ws\_get\_connection\_count\_by\_path(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{371                                                   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path);}
\DoxyCodeLine{372 }
\DoxyCodeLine{373 uvhttp\_error\_t uvhttp\_server\_ws\_broadcast(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{374                                           \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* data,}
\DoxyCodeLine{375                                           \textcolor{keywordtype}{size\_t} len);}
\DoxyCodeLine{376 }
\DoxyCodeLine{377 uvhttp\_error\_t uvhttp\_server\_ws\_close\_all(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{378                                           \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path);}
\DoxyCodeLine{379 }
\DoxyCodeLine{380 \textcolor{comment}{/* 内部函数（由 uvhttp\_connection 调用） */}}
\DoxyCodeLine{381 \textcolor{keywordtype}{void} uvhttp\_server\_ws\_add\_connection(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{382                                      uvhttp\_ws\_connection\_t* ws\_conn,}
\DoxyCodeLine{383                                      \textcolor{keyword}{const} \textcolor{keywordtype}{char}* path);}
\DoxyCodeLine{384 }
\DoxyCodeLine{385 \textcolor{keywordtype}{void} uvhttp\_server\_ws\_remove\_connection(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{386                                         uvhttp\_ws\_connection\_t* ws\_conn);}
\DoxyCodeLine{387 }
\DoxyCodeLine{388 \textcolor{keywordtype}{void} uvhttp\_server\_ws\_update\_activity(\mbox{\hyperlink{structuvhttp__server}{uvhttp\_server\_t}}* server,}
\DoxyCodeLine{389                                       uvhttp\_ws\_connection\_t* ws\_conn);}
\DoxyCodeLine{390 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{391 }
\DoxyCodeLine{392 \textcolor{comment}{/* 内部函数声明 */}}
\DoxyCodeLine{393 uvhttp\_error\_t uvhttp\_request\_init(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request, uv\_tcp\_t* client);}
\DoxyCodeLine{394 \textcolor{keywordtype}{void} uvhttp\_request\_cleanup(\mbox{\hyperlink{structuvhttp__request}{uvhttp\_request\_t}}* request);}
\DoxyCodeLine{395 }
\DoxyCodeLine{396 \textcolor{comment}{/* TLS函数声明 (暂时禁用) */}}
\DoxyCodeLine{397 \textcolor{comment}{/* uvhttp\_error\_t uvhttp\_tls\_init(void); */}}
\DoxyCodeLine{398 \textcolor{comment}{/* void uvhttp\_tls\_context\_free(uvhttp\_tls\_context\_t* ctx); */}}
\DoxyCodeLine{399 }
\DoxyCodeLine{400 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{401 \}}
\DoxyCodeLine{402 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{403 }
\DoxyCodeLine{404 \textcolor{preprocessor}{\#endif }\textcolor{comment}{/* UVHTTP\_SERVER\_H */}\textcolor{preprocessor}{}}

\end{DoxyCode}
