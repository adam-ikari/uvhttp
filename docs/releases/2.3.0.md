---
title: v2.3.0 Release
description: Release notes and migration guide for UVHTTP v2.3.0
date: 2026-02-04
version: 2.3.0
previous: 2.2.2
next: 2.4.0
---

# UVHTTP v2.3.0 Release

**Release Date:** 2026-02-04
**Version:** 2.3.0
**Type:** Major Release

## üìã Overview

UVHTTP v2.3.0 is a major release that introduces significant improvements to the LRU Cache system, including application layer flexibility features, simplified design, and enhanced performance. This release also includes important bug fixes and documentation improvements.

## ‚ú® New Features

### LRU Cache Flexibility Features

New features to give application layer more control over cache behavior:

1. **Priority-based Eviction**
   - Set entry priority (0-10, 0 = lowest)
   - Enable/disable priority eviction mode
   - Set minimum priority threshold
   - Application can control which entries to evict first

2. **Custom Eviction Callback**
   - Set custom callback before entry eviction
   - Useful for cleanup operations and monitoring
   - Zero overhead when not used

3. **Cache Prewarming**
   - Pre-load hot files on startup
   - Batch prewarming with priority settings
   - Improve first-access performance

4. **Cache Policy Configuration**
   - All features configurable at runtime
   - Opt-in design (disabled by default)
   - Zero performance overhead when disabled

**Usage Example:**
```c
// Set hot files to high priority
uvhttp_lru_cache_set_entry_priority(cache, "/static/index.html", 10);
uvhttp_lru_cache_set_entry_priority(cache, "/static/main.js", 9);

// Enable priority eviction
uvhttp_lru_cache_enable_priority_eviction(cache, 1);
uvhttp_lru_cache_set_min_priority_threshold(cache, 5);

// Set custom eviction callback
void my_eviction_callback(const char* file_path, size_t size, int priority) {
    printf("Evicting: %s (size: %zu, priority: %d)\n", file_path, size, priority);
}
uvhttp_lru_cache_set_eviction_callback(cache, my_eviction_callback);

// Prewarm cache
const char* hot_files[] = {"/static/index.html", "/static/main.js"};
uvhttp_lru_cache_prewarm(cache, hot_files, 2, 10);
```

### Router Cache Optimization

- CPU cache optimization: node size reduced by 53%
- Cache line usage reduced by 60%
- Improved cache locality for better performance

### Protocol Upgrade Framework

- Zero-overhead protocol upgrade framework
- WebSocket refactored to use new framework
- Support for custom protocols (IPPS, gRPC-Web)

## üêõ Bug Fixes

- **Format Check Issues** - Fixed code formatting issues in LRU Cache and related files
- **32-bit Build Failure** - Fixed `uint64_t` formatting for cross-platform compatibility
- **Router Parameter Loss** - Fixed path parameter loss in parameterized routes
- **Stack Overflow Risk** - Added recursion depth limit to prevent stack overflow
- **TLS Memory Leak** - Fixed TLS connection memory leak (2-4KB per connection)

## üîß Breaking Changes

### LRU Cache Simplification

**Description:** Simplified LRU Cache to follow UVHTTP design philosophy by removing over-engineered features.

**Changes:**
- Removed LFU and Hybrid eviction modes (keep only LRU)
- Removed dual-threshold eviction mechanism (80%/95%)
- Removed task queue mechanism (uv_async_t, uv_loop_t)
- Removed 5 deprecated API functions

**Migration Required:** Yes

**Migration Guide:** See [Migration Guide](#migration-guide) below

### Removed APIs

The following APIs have been removed:

- `uvhttp_lru_cache_set_eviction_mode()` - Use priority-based eviction instead
- `uvhttp_lru_cache_init_task_queue()` - No longer needed (synchronous eviction)
- `uvhttp_lru_cache_schedule_eviction()` - No longer needed (synchronous eviction)
- `uvhttp_lru_cache_stop_task_queue()` - No longer needed (synchronous eviction)
- `uvhttp_lru_cache_perform_eviction()` - No longer needed (automatic eviction)

## üìä Performance Improvements

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| LRU Cache Code Size | 940 lines | 708 lines | -21% |
| Memory Overhead/Instance | 132 bytes | 0 bytes | -100% |
| Memory Overhead/Entry | 4 bytes | 0 bytes | -100% |
| Router Node Size | 272 bytes | 128 bytes | -53% |
| Router Cache Line Usage | 5 lines | 2 lines | -60% |

## üîí Security Updates

- **Buffer Overflow Protection** - Enhanced input validation and boundary checks
- **TLS 1.3 Support** - Full TLS 1.3 support with mbedtls

## üìù API Changes

### New APIs

- `uvhttp_lru_cache_enable_priority_eviction()` - Enable/disable priority eviction
- `uvhttp_lru_cache_set_min_priority_threshold()` - Set minimum priority threshold
- `uvhttp_lru_cache_set_entry_priority()` - Set entry priority
- `uvhttp_lru_cache_set_eviction_callback()` - Set custom eviction callback
- `uvhttp_lru_cache_prewarm()` - Pre-load cache entries

### Deprecated APIs

None in this release.

### Removed APIs

See [Breaking Changes](#breaking-changes) section above.

## üß™ Testing

- **Unit Tests:** 280 tests
- **Integration Tests:** 2 tests
- **Code Coverage:** 42.9%

## üì¶ Installation

### From Source

```bash
git clone https://github.com/adam-ikari/uvhttp.git
cd uvhttp
git checkout v2.3.0
mkdir build && cd build
cmake ..
make -j$(nproc)
```

## üîÑ Migration Guide from v2.2.2

This guide helps you migrate from UVHTTP v2.2.2 to v2.3.0.

### Prerequisites

- UVHTTP v2.2.2 or later
- CMake 3.10+
- C11 compatible compiler

### Migration Overview

v2.3.0 introduces significant changes to the LRU Cache system, including the removal of over-engineered features (LFU/Hybrid eviction modes, task queue mechanism) and the addition of new flexibility features (priority-based eviction, custom callbacks, cache prewarming). The migration involves removing deprecated APIs and optionally adopting new flexibility features.

### Step-by-Step Migration

#### 1. Update Dependencies

No new dependencies required.

#### 2. Update Code

**Removed API: `uvhttp_lru_cache_set_eviction_mode()`**

**Before (v2.2.2):**
```c
// Set eviction mode to LFU
uvhttp_lru_cache_set_eviction_mode(cache, UVHTTP_CACHE_EVICTION_MODE_LFU);
```

**After (v2.3.0):**
```c
// Use priority-based eviction instead (optional)
uvhttp_lru_cache_enable_priority_eviction(cache, 1);
```

**Removed API: `uvhttp_lru_cache_init_task_queue()`**

**Before (v2.2.2):**
```c
// Initialize task queue for async eviction
uvhttp_lru_cache_init_task_queue(cache, loop);
```

**After (v2.3.0):**
```c
// No longer needed - eviction is now synchronous and automatic
```

**Removed API: `uvhttp_lru_cache_schedule_eviction()`**

**Before (v2.2.2):**
```c
// Schedule eviction task
uvhttp_lru_cache_schedule_eviction(cache);
```

**After (v2.3.0):**
```c
// No longer needed - eviction is automatic when cache is full
```

**Removed API: `uvhttp_lru_cache_stop_task_queue()`**

**Before (v2.2.2):**
```c
// Stop task queue
uvhttp_lru_cache_stop_task_queue(cache);
```

**After (v2.3.0):**
```c
// No longer needed - no task queue to stop
```

**Removed API: `uvhttp_lru_cache_perform_eviction()`**

**Before (v2.2.2):**
```c
// Perform eviction manually
uvhttp_lru_cache_perform_eviction(cache);
```

**After (v2.3.0):**
```c
// No longer needed - eviction is automatic
```

#### 3. Rebuild

```bash
cd build
cmake ..
make clean
make -j$(nproc)
```

#### 4. Test

```bash
# Run unit tests
./dist/bin/uvhttp_unit_tests

# Run LRU Cache tests
./dist/bin/test_lru_cache_full_coverage
```

### Common Migration Issues

#### Issue 1: Compilation Error - Missing Function

**Symptom:** `error: implicit declaration of function 'uvhttp_lru_cache_set_eviction_mode'`

**Solution:** Remove all calls to the deprecated functions listed in the [Breaking Changes](#breaking-changes) section. The new LRU Cache design is simpler and does not require these functions.

#### Issue 2: Performance Regression

**Symptom:** Cache eviction seems slower or different than before

**Solution:** This is expected behavior. The new LRU Cache uses synchronous eviction with a single threshold (90%). If you need more control, enable priority-based eviction:

```c
// Enable priority-based eviction
uvhttp_lru_cache_enable_priority_eviction(cache, 1);
uvhttp_lru_cache_set_min_priority_threshold(cache, 5);

// Set high priority for important files
uvhttp_lru_cache_set_entry_priority(cache, "/static/index.html", 10);
uvhttp_lru_cache_set_entry_priority(cache, "/static/main.js", 9);
```

#### Issue 3: Memory Usage Changes

**Symptom:** Memory usage appears different

**Solution:** The new LRU Cache has reduced memory overhead (0 bytes per instance and entry vs 132 bytes and 4 bytes before). This is an improvement, not an issue.

### Migration Checklist

- [x] Read all breaking changes
- [x] Update dependencies
- [x] Update code to remove deprecated APIs
- [x] Rebuild project
- [x] Run tests
- [x] Verify performance
- [x] Update documentation

## üìö Documentation

- [API Reference](/api/API_REFERENCE.md)
- [Architecture](/dev/ARCHITECTURE.md)
- [Developer Guide](/guide/DEVELOPER_GUIDE.md)
- [Migration Guide](/MIGRATION_GUIDE_LRU_CACHE.md)

## ü§ù Contributing

Thank you to all contributors who made this release possible:

- [@adam-ikari](https://github.com/adam-ikari)

## üìã Full Changelog

See [CHANGELOG.md](/CHANGELOG.md) for complete changelog.

## üîó Links

- [GitHub Release](https://github.com/adam-ikari/uvhttp/releases/tag/v2.3.0)
- [Milestone](https://github.com/adam-ikari/uvhttp/milestone/2.3.0?closed=1)
- [Issues Closed](https://github.com/adam-ikari/uvhttp/issues?q=milestone%3A2.3.0+is%3Aclosed)

## ‚ö†Ô∏è Known Issues

- Performance benchmark tests may timeout in PR validation (5-minute limit)
- Some documentation links may need updating

## üöÄ Next Steps

- Upgrade to UVHTTP v2.3.0
- Update your code to remove deprecated APIs
- Test thoroughly in staging environment
- Report any issues on [GitHub Issues](https://github.com/adam-ikari/uvhttp/issues)

---

**Need Help?**

- [FAQ](/FAQ.md)
- [GitHub Issues](https://github.com/adam-ikari/uvhttp/issues)
- [GitHub Discussions](https://github.com/adam-ikari/uvhttp/discussions)